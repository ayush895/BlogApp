{% load static %}
<!DOCTYPE html>
<html>
<head>
  <title>Reset Password</title>
  <link rel="stylesheet" href="{% static 'authentication/css/style.css' %}" />
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
  />
</head>
<body style="padding-bottom:72px;">
  <div class="auth-container">
    <h2>Reset Password</h2>

    {% if messages %}
    <ul class="messages">
      {% for message in messages %}
      <li class="{{ message.tags }}">{{ message }}</li>
      {% endfor %}
    </ul>
    {% endif %}

    <form method="POST" action="" id="resetForm">
      {% csrf_token %}

      <div class="input-group">
        <div class="input-field-container password-field">
          <input
            type="password"
            name="new_password"
            id="new_password"
            placeholder="Enter new password"
            value=""
            autocomplete="new-password"
            required
          />
          <span class="toggle-password" id="toggleNewPassword">
            <i class="fa fa-eye"></i>
          </span>
          <div class="validation-icon" id="new-password-icon"></div>
        </div>
        <div class="error-message" id="new-password-error"></div>
      </div>

      <div class="input-group">
        <div class="input-field-container password-field">
          <input
            type="password"
            name="confirm_password"
            id="confirm_password"
            placeholder="Confirm new password"
            value=""
            autocomplete="new-password"
            required
          />
          <span class="toggle-password" id="toggleConfirmPassword">
            <i class="fa fa-eye"></i>
          </span>
          <div class="validation-icon" id="confirm-password-icon"></div>
        </div>
        <div class="error-message" id="confirm-password-error"></div>
      </div>

      <button type="submit" class="btn" id="submitBtn">Reset Password</button>
    </form>

    <p><a href="{% url 'login' %}">Back to Login</a></p>
  </div>

  <!-- Tooltip for errors -->
  <div id="errorTooltip" class="error-tooltip"></div>

  <footer>
    <p>Â© {% now "Y" %} My Blog | Built with Django & Bootstrap</p>
  </footer>

  <script>
    // Password toggle functionality
    const toggleNewPassword = document.querySelector("#toggleNewPassword");
    const newPassword = document.querySelector("#new_password");

    toggleNewPassword.addEventListener("click", function () {
      const type = newPassword.getAttribute("type") === "password" ? "text" : "password";
      newPassword.setAttribute("type", type);
      this.innerHTML = type === "password"
        ? '<i class="fa fa-eye"></i>'
        : '<i class="fa fa-eye-slash"></i>';
    });

    const toggleConfirmPassword = document.querySelector("#toggleConfirmPassword");
    const confirmPassword = document.querySelector("#confirm_password");

    toggleConfirmPassword.addEventListener("click", function () {
      const type = confirmPassword.getAttribute("type") === "password" ? "text" : "password";
      confirmPassword.setAttribute("type", type);
      this.innerHTML = type === "password"
        ? '<i class="fa fa-eye"></i>'
        : '<i class="fa fa-eye-slash"></i>';
    });

    // Password validation
    function validatePasswords() {
      const newPass = document.getElementById('new_password').value;
      const confirmPass = document.getElementById('confirm_password').value;
      const submitBtn = document.getElementById('submitBtn');
      
      if (newPass && confirmPass && newPass === confirmPass) {
        submitBtn.disabled = false;
        submitBtn.style.opacity = '1';
      } else {
        submitBtn.disabled = true;
        submitBtn.style.opacity = '0.6';
      }
    }

    document.getElementById('new_password').addEventListener('input', validatePasswords);
    document.getElementById('confirm_password').addEventListener('input', validatePasswords);

    // Initial state
    validatePasswords();
  </script>
</body>
</html>
